package com.jasminesloan.tamarbraxton;


import java.util.ArrayList;
import java.util.HashMap;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import com.jasminesloan.tamarbraxton.library.JSON;

import android.annotation.SuppressLint;
import android.app.Fragment;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.View.OnClickListener;
import android.widget.AdapterView;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.ListView;
import android.widget.SimpleAdapter;
import android.widget.TextView;
import android.widget.Toast;


@SuppressLint("NewApi")
public class MainFragment extends Fragment{

	TextView albumMessage;
	ListView listview;
	JSON json;
	Boolean connected = false;
	Context _context;
	Button searchButton;
	Button displayButton;
	EditText searchField;
	ArrayList<HashMap<String, String>> albumList = new ArrayList<HashMap<String,String>>();
	
	private FormListener listener;
	
	public interface FormListener{

		public void onItemSearch();
		public String onSongSearch(String value);
		
	}
	
	@Override
	public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState){
		super.onCreateView(inflater, container, savedInstanceState);
		Toast.makeText(getActivity(), "FRAGMENT", Toast.LENGTH_SHORT).show();
		Log.e("FRAGMENT", "onCreate");
		LinearLayout view = (LinearLayout) inflater.inflate(R.layout.activity_main, container, false);
		
		Button displayAllButton = (Button) view.findViewById(R.id.displayButton);
		displayAllButton.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {
				// TODO Auto-generated method stub
			
				displayInfo();
			}
		});
		 
		 
		 
		 
		 
		 return view;
		
	}

	protected void displayInfo() {
		// TODO Auto-generated method stub
		JSON.getInstance();
        String JSONString = JSON.readStringFile(this, "tamar.txt");

        HashMap<String, String> displayAlbum;

        JSONObject object = null;
        JSONArray records = null;

        try {
       	 object = new JSONObject(JSONString);   
       	 records = object.getJSONArray("results");
 
       	 int count = object.getInt("resultCount");

       	 albumMessage.setText("There are " + count + " songs");

       	 for(int i = 0; i < count; i++){
            
            JSONObject recordObject = records.getJSONObject(i);
            String album;
            String track;
            String trackNumber;
            String artistView;
            String country;
            String genre;
            String release;
            
            try {
                    album = recordObject.getString("collectionName");
            } catch (Exception e) {
                    album = "unknown";
            }
            try {
                    track = recordObject.getString("trackName");
            } catch (Exception e) {
                    track = "unknown";
            }
            try {
                    trackNumber = recordObject.getString("trackNumber");
            } catch (Exception e){
                    trackNumber = "unknown";
            }
            try {
           	 artistView = recordObject.getString("artistViewUrl");
            } catch (Exception e){
       	 artistView = "unknown";
        	} 
            try {
        		country = recordObject.getString("country");
        	} catch (Exception e){
        		country = "unknown";
        	}
            try {
           	 genre = recordObject.getString("primaryGenreName");
         	} catch (Exception e){
         		genre = "unknown";
         	}
            try {
           	 release = recordObject.getString("releaseDate");
        	} catch (Exception e){
        		release = "unknown";
        	}


            displayAlbum = new HashMap<String, String>();
            displayAlbum.put("collectionName", album);
            displayAlbum.put("trackName", track);
            displayAlbum.put("trackNumber", trackNumber);
            displayAlbum.put("artistViewUrl", artistView);
            displayAlbum.put("country", country);
            displayAlbum.put("primaryGenreName", genre);
            displayAlbum.put("releaseDate", release);

            albumList.add(displayAlbum);
              } 
       
       SimpleAdapter albumAdapter = new SimpleAdapter(this, albumList, R.layout.listview, new String[] {"collectionName", "trackName", "trackNumber"}, new int[] {R.id.album, R.id.song, R.id.trackNumber});
       listview.setAdapter(albumAdapter);
       listview.setOnItemClickListener(new AdapterView.OnItemClickListener() {

			@Override
			public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
				// TODO Auto-generated method stub
				@SuppressWarnings("unchecked")
				HashMap<String, String> songMap = (HashMap<String, String>)parent.getItemAtPosition(position);
				
				String songTitle = songMap.get("trackName").toString();
				String albumName = songMap.get("collectionName").toString();
				String songNumber = songMap.get("trackNumber").toString();
				String artistUrl = songMap.get("artistViewUrl").toString();
				String country = songMap.get("country").toString();
				String genre = songMap.get("primaryGenreName").toString();
				String release = songMap.get("releaseDate").toString();
				
				
				
				Intent intent = new Intent(_context, ActivityTwo.class);
				intent.putExtra("collectionName", albumName);
				intent.putExtra("trackName", songTitle);
				intent.putExtra("trackNumber", songNumber);
				intent.putExtra("artistViewUrl", artistUrl);
				intent.putExtra("country", country);
				intent.putExtra("primaryGenreName", genre);
				intent.putExtra("releaseDate", release);
				//intent.setData(Uri.parse(songTitle));
				
				
				startActivityForResult(intent, 0);
				Log.i("MAIN", "OnItemClick Selected");
			}
		});
    
       }catch (JSONException e) {
                  // TODO Auto-generated catch block
                  e.printStackTrace();
          }
	}




}
